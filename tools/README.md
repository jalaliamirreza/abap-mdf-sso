# ๐ง SSO DBF Conversion Tools
# ุงุจุฒุงุฑูุง ุชุจุฏู ูุงู DBF ุณุงุฒูุงู ุชุงูู ุงุฌุชูุงุน

ุงู ุงุจุฒุงุฑูุง ุจุฑุง ุชุจุฏู ุฏูุทุฑูู ุจู CSV ู DBF ุทุฑุงุญ ุดุฏูโุงูุฏ.

## ๐ฅ CSV to DBF

ุชุจุฏู ูุงู CSV ุจู ูุฑูุช DBF ุจุฑุง ุขูพููุฏ ุจู ุณุงุช ุชุงูู ุงุฌุชูุงุน.

### ุงุณุชูุงุฏู:

```bash
python csv_to_dbf.py workers.csv \
  --workshop-id "1234567890" \
  --year 3 \
  --month 9 \
  --output dskwor00.dbf
```

### ูุฑูุช CSV:

ูุงู CSV ุจุงุฏ ุณุชููโูุง ุฒุฑ ุฑุง ุฏุงุดุชู ุจุงุดุฏ:

```csv
DSW_ID1,PER_NATCOD,DSW_FNAME,DSW_LNAME,DSW_DNAME,DSW_IDNO,...
49874664,3990106619,ุนู,ุงุญูุฏ,ูุญูุฏ,12345,...
```

**ูฺฉุงุช ููู:**
- ุณุทุฑ ุงูู: ูุงู ุณุชููโูุง
- ูุชูโูุง ูุงุฑุณ ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุจุง Iran System encoding ฺฉุฏฺฏุฐุงุฑ ูโุดููุฏ
- ุชุงุฑุฎโูุง ุจุงุฏ ุจู ูุฑูุช YYYYMMDD (ุดูุณ) ุจุงุดูุฏ
- ููุฏูุง ุนุฏุฏ ุจุงุฏ ุนุฏุฏ ุจุงุดูุฏ (ุจุฏูู ุฌุฏุงฺฉููุฏู ูุฒุงุฑฺฏุงู)

### ููุฏูุง ูุงุฑุณ:

ุงู ููุฏูุง ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ encode ูโุดููุฏ:
- `DSW_FNAME` - ูุงู
- `DSW_LNAME` - ูุงู ุฎุงููุงุฏฺฏ
- `DSW_DNAME` - ูุงู ูพุฏุฑ
- `DSW_IDPLC` - ูุญู ุตุฏูุฑ
- `DSW_OCP` - ุดุบู

---

## ๐ค DBF to CSV

ุชุจุฏู ูุงู DBF ุจู CSV ุจุฑุง ูุดุงูุฏู ู ูุฑุงุด ุฏุฑ Excel.

### ุงุณุชูุงุฏู:

```bash
# ุจุฏูู hex (ููุท ููุฏูุง ุนุฏุฏ)
python dbf_to_csv.py dskwor00.dbf --output workers.csv

# ุจุง hex (ุดุงูู Persian hex bytes)
python dbf_to_csv.py dskwor00.dbf --output workers.csv --include-hex
```

### ุฎุฑูุฌ:

**ุจุฏูู --include-hex:**
```csv
DSW_ID1,PER_NATCOD,DSW_FNAME,DSW_LNAME,DSW_DD,DSW_MAH,...
49874664,3990106619,,,30,128095062,...
```

**ุจุง --include-hex:**
```csv
DSW_ID1,PER_NATCOD,DSW_FNAME,DSW_FNAME_HEX,DSW_DD,...
49874664,3990106619,,fcf3e4,30,...
```

**ุชูุฌู:** ููุฏูุง ูุงุฑุณ ุจุง Iran System encoding ฺฉุฏฺฏุฐุงุฑ ุดุฏูโุงูุฏ ู ูุงุจู decode ุจู Unicode ูุณุชูุฏ. ููุท ูโุชูุงูุฏ hex bytes ุขููุง ุฑุง ูุดุงูุฏู ฺฉูุฏ.

---

## ๐ Workflow ฺฉุงูู

### 1๏ธโฃ ุงุฌุงุฏ DBF ุงุฒ Excel:

```bash
# 1. ุฏุฑ Excel ูุงู CSV ุจุณุงุฒุฏ
# 2. ุชุจุฏู ุจู DBF:
python csv_to_dbf.py workers.csv \
  --workshop-id "ฺฉุฏ ฺฉุงุฑฺฏุงู" \
  --year 3 \
  --month 9 \
  --output dskwor00.dbf

# 3. ูุงู dskwor00.dbf ุขูุงุฏู ุขูพููุฏ ุจู ุณุงุช ุจูู ุงุณุช
```

### 2๏ธโฃ ุจุฑุฑุณ DBF ููุฌูุฏ:

```bash
# ุชุจุฏู ุจู CSV ุจุฑุง ูุดุงูุฏู
python dbf_to_csv.py dskwor00.dbf --output check.csv --include-hex

# ูุดุงูุฏู ุฏุฑ Excel
libreoffice check.csv
```

### 3๏ธโฃ ูุฑุงุด ู ุงุฌุงุฏ ูุฌุฏุฏ:

```bash
# 1. DBF ุฑุง ุจู CSV ุชุจุฏู ฺฉูุฏ
python dbf_to_csv.py dskwor00.dbf --output workers.csv

# 2. ุฏุฑ Excel ูุฑุงุด ฺฉูุฏ
# 3. ุฏูุจุงุฑู ุจู DBF ุชุจุฏู ฺฉูุฏ
python csv_to_dbf.py workers_edited.csv \
  --workshop-id "1234567890" \
  --year 3 \
  --month 9 \
  --output dskwor00_new.dbf
```

---

## ๐ ุณุงุฎุชุงุฑ ููุฏูุง DBF

### dskwor00.dbf (31 ููุฏ):

| ููุฏ | ููุน | ุทูู | ุชูุถุญ |
|------|-----|------|-------|
| DSW_ID | C | 10 | ุดูุงุณู ฺฉุงุฑฺฏุงู |
| DSW_YY | N | 2 | ุณุงู |
| DSW_MM | N | 2 | ูุงู |
| DSW_ID1 | C | 8 | **ุดูุงุฑู ุจูู (ููุท 8 ุฑูู!)** |
| DSW_FNAME | C | 20 | ูุงู (Iran System encoding) |
| DSW_LNAME | C | 25 | ูุงู ุฎุงููุงุฏฺฏ (Iran System encoding) |
| DSW_DNAME | C | 20 | ูุงู ูพุฏุฑ (Iran System encoding) |
| DSW_BDATE | C | 8 | ุชุงุฑุฎ ุชููุฏ (YYYYMMDD ุดูุณ) |
| DSW_DD | N | 2 | ุฑูุฒ ฺฉุงุฑฺฉุฑุฏ |
| DSW_MAH | N | 12 | ุญููู ูุงูุงูู (ุฑุงู) |
| DSW_MAZ | N | 12 | ูุฒุงุง (ุฑุงู) |
| DSW_MASH | N | 12 | ูุดููู ุจูู (ุฑุงู) |
| DSW_BIME | N | 12 | ุญู ุจูู (7% ูุดููู) |
| PER_NATCOD | C | 10 | ฺฉุฏ ูู |
| ... | ... | ... | ... |

**ููู:**
- `DSW_BIME` = `DSW_MASH` ร 0.07 (7 ุฏุฑุตุฏ)
- ุชุงุฑุฎโูุง ุจุงุฏ ุดูุณ ุจุงุดูุฏ (ูุซุงู: 14030915)
- ุดูุงุฑู ุจูู (`DSW_ID1`) ููุท 8 ฺฉุงุฑุงฺฉุชุฑ ุงุณุช!

---

## ๐งช ุชุณุช ู ุจุฑุฑุณ

### ุจุฑุฑุณ encoding ูุงุฑุณ:

```bash
python ../src/utils/extract_raw_bytes.py dskwor00.dbf
```

ุงู ุงุจุฒุงุฑ hex bytes ููุฏูุง ูุงุฑุณ ุฑุง ููุงุด ูโุฏูุฏ.

**ูุซุงู ุฎุฑูุฌ:**
```
ุฑฺฉูุฑุฏ #1:
DSW_FNAME:
  Hex:   fc f3 e4
  Bytes: [252, 243, 228]
```

### ููุงุณู ุจุง ูุงู ุงุตู:

```bash
# ุงุณุชุฎุฑุงุฌ ุงุฒ ูุงู ุดูุง
python ../src/utils/extract_raw_bytes.py your_file.dbf > your_output.txt

# ุงุณุชุฎุฑุงุฌ ุงุฒ ูุงู ุงุตู SSO
python ../src/utils/extract_raw_bytes.py original_sso.dbf > original_output.txt

# ููุงุณู
diff your_output.txt original_output.txt
```

---

## โ๏ธ ูุงุฒููุฏโูุง

```bash
pip install dbfread dbf
```

---

## ๐ฏ Iran System Encoding

ุงู ุงุจุฒุงุฑูุง ุงุฒ **Iran System encoding** ุงุณุชูุงุฏู ูโฺฉููุฏ ฺฉู ฺฉ encoding ุฎุงุต ุจุฑุง ูุงูโูุง DBF ุณุงุฒูุงู ุชุงูู ุงุฌุชูุงุน ุงุณุช.

**ูฺฺฏโูุง:**
- Context-sensitive: ูุฑ ุญุฑู ุจุณุชู ุจู ูููุนุชุด 4 ุดฺฉู ูุฎุชูู ุฏุงุฑุฏ
- ฺฉโุทุฑูู: ููโุชูุงู decode ฺฉุฑุฏ
- ูุทุงุจู ุจุง ฺฉุฏ C# ุงุฒ: https://github.com/amirfahmideh/InsuranceToDbf

**ุชุณุชโุดุฏู ู ุชุงุฏโุดุฏู:**
- โ "ุนู" โ `fc f3 e4` (ุชุทุงุจู 100%)
- โ "ูุญูุฏุญุณู" โ `f6 fe a8 9f a2 f5 9f f5`
- โ "ุงุญูุฏ" โ `fc a2 f5 9f 90`

---

## ๐ ูพุดุชุจุงู

ุจุฑุง ูุดฺฉูุงุช ุง ุณูุงูุงุช:
1. ฺฺฉ ฺฉูุฏ ฺฉู ูุฑูุช CSV ุฏุฑุณุช ุงุณุช
2. ุชุณุช ฺฉูุฏ ุจุง ูุงูโูุง ููููู
3. hex bytes ุฑุง ุจุฑุฑุณ ฺฉูุฏ

---

**ูุณุฎู:** 1.0
**ุชุงุฑุฎ:** 1403/09/02
