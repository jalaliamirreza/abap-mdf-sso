# ูุฑูุฑ ฺฉุงูู ูพุฑูฺู
# SAP Payroll to SSO DBF Converter - Project Overview

**ุชุงุฑุฎ ุจูโุฑูุฒุฑุณุงู:** 1403/09/02
**ูุถุนุช:** โ ุขูุงุฏู ุชููุฏ (Production Ready)
**ูุณุฎู SSO:** 2024 (ุณุงุฎุชุงุฑ ุฌุฏุฏ)

---

## ๐ฏ ูุฏู ูพุฑูฺู

ุชุจุฏู ุงุทูุงุนุงุช ุญููู ู ุฏุณุชูุฒุฏ ฺฉุงุฑฺฏุฑุงู ุจู ูุฑูุช DBF ูุงุจู ุขูพููุฏ ุจู ุณุงุช **ุณุงุฒูุงู ุชุงูู ุงุฌุชูุงุน ุงุฑุงู**.

### ูฺฺฏโูุง ฺฉูุฏ:
- โ ุชุจุฏู ุฏูุทุฑูู **CSV โ DBF**
- โ ูพุดุชุจุงู ฺฉุงูู ุงุฒ **Iran System Encoding** (ูุชู ูุงุฑุณ)
- โ ุณุงุฒฺฏุงุฑ ุจุง **ุณุงุฎุชุงุฑ ุฌุฏุฏ SSO 2024** (ุชุณุช ุดุฏู ู ุชุงุฏ ุดุฏู)
- โ ุฑุงุจุทโูุง **CLI** ู **GUI**
- โ ูุญุงุณุจู ุฎูุฏฺฉุงุฑ ุญู ุจูู
- โ ุชุณุชโูุง ุฌุงูุน Round-Trip

---

## ๐ ุณุงุฎุชุงุฑ ูพุฑูฺู

```
abap-mdf-sso/
โ
โโโ ๐ src/                          # ฺฉุฏ ุงุตู ูพุฑูฺู
โ   โโโ utils/                       # ุงุจุฒุงุฑูุง ูพุงู
โ   โ   โโโ iran_system_encoding.py  # ฺฉุฏฺฏุฐุงุฑ Iran System
โ   โ   โโโ iran_system_decoder.py   # ุฏฺฉุฏุฑ Iran System
โ   โ   โโโ jalali_converter.py      # ุชุจุฏู ุชุงุฑุฎ ุดูุณ
โ   โ   โโโ generate_dbf.py          # ุชููุฏ ูุงู DBF
โ   โ   โโโ inspect_dbf.py           # ุจุฑุฑุณ ุณุงุฎุชุงุฑ DBF
โ   โ   โโโ test_encoding.py         # ุชุณุชโูุง encoding
โ   โ
โ   โโโ generators/                  # ุชููุฏฺฉููุฏูโูุง DBF
โ   โ   โโโ generate_dskwor.py       # ุชููุฏ ูุงู ฺฉุงุฑฺฏุฑุงู
โ   โ
โ   โโโ transform/                   # ุชุจุฏู ุฏุงุฏูโูุง
โ   โโโ abap/                        # ฺฉูพุงุฑฺฺฏ SAP (ุขูุฏู)
โ
โโโ ๐ tools/                        # ุงุจุฒุงุฑูุง ฺฉุงุฑุจุฑุฏ โญ
โ   โโโ csv_to_dbf_complete.py       # CSV โ DBF (ูุฑ ุฏู ูุงู)
โ   โโโ dbf_to_csv.py                # DBF โ CSV (ุชฺฉ ูุงู)
โ   โโโ dbf_converter_gui.py         # ุฑุงุจุท ฺฏุฑุงูฺฉ
โ   โโโ csv_to_dbf.py                # ุชุจุฏู ุณุงุฏู CSVโDBF
โ   โโโ check_csv_encoding.py        # ุจุฑุฑุณ ูุดฺฉูุงุช encoding
โ
โโโ ๐ docs/                         # ูุณุชูุฏุงุช ฺฉุงูู
โ   โโโ NEW_STRUCTURE_2024.md        # ุณุงุฎุชุงุฑ ุฌุฏุฏ SSO (ูุฑุฌุน ุงุตู)
โ   โโโ MIGRATION_TO_NEW_STRUCTURE.md # ุฑุงูููุง ููุงุฌุฑุช
โ   โโโ REAL_STRUCTURE_ANALYSIS.md   # ุชุญูู ุณุงุฎุชุงุฑ ูุงูุน
โ   โโโ ENCODING_VERIFIED.md         # ุชุงุฏ encoding
โ   โโโ SSO_FORMAT_SPEC.md           # ูุดุฎุตุงุช ูุฑูุช SSO
โ   โโโ INSTALLATION.md              # ุฑุงูููุง ูุตุจ
โ   โโโ USAGE.md                     # ุฑุงูููุง ุงุณุชูุงุฏู
โ   โโโ PROJECT_OVERVIEW.md          # ุงู ูุงู
โ
โโโ ๐ sample/                       # ูุงูโูุง ููููู ูุฏู (ูุฑุฌุน)
โ   โโโ dskkar00.dbf                 # Header DBF ูุงูุน
โ   โโโ dskwor00.dbf                 # Workers DBF ูุงูุน
โ   โโโ header.csv                   # ููููู header CSV
โ   โโโ workers.csv                  # ููููู workers CSV
โ
โโโ ๐ newsample/                    # ุณุงุฎุชุงุฑ ุฌุฏุฏ SSO 2024 โญ
โ   โโโ DSKKAR00.DBF                 # Template header (25 ููุฏ)
โ   โโโ DSKWOR00.DBF                 # Template workers (29 ููุฏ)
โ
โโโ ๐ sample_output/                # ุฎุฑูุฌ ููููู ุขูุงุฏู ุขูพููุฏ โญ
โ   โโโ dskkar00.dbf                 # Header ุชุณุช ุดุฏู
โ   โโโ dskwor00.dbf                 # Workers ุชุณุช ุดุฏู
โ   โโโ header_real.csv              # CSV ูุฑูุฏ
โ   โโโ workers_real.csv             # CSV ูุฑูุฏ
โ   โโโ README.md                    # ุฑุงูููุง ุงุณุชูุงุฏู
โ
โโโ ๐ tests/                        # ุชุณุชโูุง ุฎูุฏฺฉุงุฑ
โโโ ๐ config/                       # ุชูุธูุงุช
โ
โโโ README.md                        # ุฑุงูููุง ุงุตู
โโโ requirements.txt                 # ูุงุจุณุชฺฏโูุง Python
โโโ .gitignore                       # ูุงูโูุง ูุงุฏุฏู ฺฏุฑูุชู ุดุฏู

```

---

## ๐ง ุงุจุฒุงุฑูุง ุงุตู

### 1. **csv_to_dbf_complete.py** - ุชุจุฏู CSV ุจู DBF

**ุงุณุชูุงุฏู:**
```bash
python tools/csv_to_dbf_complete.py header.csv workers.csv \
    --workshop-id "9018282956" \
    --year 4 \
    --month 7 \
    --list-no "202407001" \
    --output-dir output
```

**ุฎุฑูุฌ:**
- `dskkar00.dbf` - ูุงู ุณุฑุขูุฏ (1 ุฑฺฉูุฑุฏ)
- `dskwor00.dbf` - ูุงู ฺฉุงุฑฺฏุฑุงู (N ุฑฺฉูุฑุฏ)

**ูฺฺฏโูุง:**
- โ ุณุงุฎุชุงุฑ SSO 2024 (25 ููุฏ header, 29 ููุฏ workers)
- โ ูุญุงุณุจู ุฎูุฏฺฉุงุฑ ุฌูุนโูุง
- โ ฺฉุฏฺฏุฐุงุฑ Iran System ุจุฑุง ูุชู ูุงุฑุณ
- โ Language Driver ID (0x7E)

---

### 2. **dbf_to_csv.py** - ุชุจุฏู DBF ุจู CSV

**ุงุณุชูุงุฏู:**
```bash
# ุชุจุฏู ุณุงุฏู
python tools/dbf_to_csv.py dskwor00.dbf --output workers.csv

# ุจุง hex ุจุฑุง ุจุฑุฑุณ encoding
python tools/dbf_to_csv.py dskwor00.dbf --output workers.csv --include-hex
```

**ูฺฺฏโูุง:**
- โ ุฏฺฉุฏ ุฎูุฏฺฉุงุฑ Iran System ุจู Unicode
- โ ููุงุด hex ุจุฑุง debugging
- โ ุชุดุฎุต ุฎูุฏฺฉุงุฑ ููุฏูุง ูุงุฑุณ

---

### 3. **dbf_converter_gui.py** - ุฑุงุจุท ฺฏุฑุงูฺฉ

**ุงุณุชูุงุฏู:**
```bash
python tools/dbf_converter_gui.py
```

**ูุงุจูุชโูุง:**
- โ Drag & drop
- โ ูพุดโููุงุด ูุงูโูุง
- โ ุชุจุฏู ุฏูุทุฑูู
- โ ุฑุงุจุท ฺฉุงุฑุจุฑ ุณุงุฏู

---

### 4. **check_csv_encoding.py** - ุจุฑุฑุณ ูุดฺฉูุงุช

**ุงุณุชูุงุฏู:**
```bash
python tools/check_csv_encoding.py workers.csv
```

**ฺฺฉ ูโฺฉูุฏ:**
- โ ฺฉุงูุง ูุงุฑุณ (ุ) vs ุงูฺฏูุณ (,)
- โ ููุทูโูุฑฺฏูู ุนุฑุจ (ุ)
- โ ุณุงุฎุชุงุฑ CSV
- โ ุชุนุฏุงุฏ ููุฏูุง

---

## ๐ Iran System Encoding

### ฺุณุชุ
ฺฉุฏฺฏุฐุงุฑ ุงุฎุชุตุงุต ุฏููุช ุงุฑุงู ุจุฑุง ูุชู ูุงุฑุณ ุฏุฑ ุณุณุชูโูุง ูุฏู.

### ูฺฺฏโูุง:
- **Context-sensitive**: ูุฑ ุญุฑู 4 ุดฺฉู ุฏุงุฑุฏ (isolated, initial, medial, final)
- **Visual order**: ูุชู ุจุฑุนฺฉุณ ุฐุฎุฑู ูโุดูุฏ (LTR ุจู ุฌุง RTL)
- **Byte mapping**: ุชุจุฏู ูุณุชูู Unicode โ Windows-1256 โ Iran System

### ูพุงุฏูโุณุงุฒ:
- `iran_system_encoding.py`: ุชุจุฏู Unicode โ Iran System
- `iran_system_decoder.py`: ุชุจุฏู Iran System โ Unicode

### ุชุณุช ุดุฏู ุจุง:
- โ ุงุณุงู ูุงุฑุณ: ุนูุ ูุงุทููุ ูุญูุฏุ ุฒูุฑุง
- โ ูุงู ุฎุงููุงุฏฺฏ: ูุญูุฏุ ุงุญูุฏุ ุฑุถุง
- โ ุดูุฑูุง: ุชูุฑุงูุ ุงุตููุงูุ ูุดูุฏ
- โ ุงุนุฏุงุฏ ูุงุฑุณ: ฐฑฒณดตถทธน
- โ ูุถุงูุง ุฎุงู (ุญูุธ ุชุฑุชุจ ุจุตุฑ)

---

## ๐ ุณุงุฎุชุงุฑ DBF (SSO 2024)

### ูุงู Header (DSKKAR00.DBF)
- **ุชุนุฏุงุฏ ููุฏูุง:** 25 (ูุจูุงู 26 ุจูุฏ)
- **ุทูู ุฑฺฉูุฑุฏ:** 311 bytes (ูุจูุงู 609 bytes)
- **ุชุนุฏุงุฏ ุฑฺฉูุฑุฏูุง:** ููุดู 1

**ููุฏ ุญุฐู ุดุฏู:**
- โ DSK_TBIM20

**ุชุบุฑุงุช ุทูู:**
| ููุฏ | ูุฏู | ุฌุฏุฏ | ุชุบุฑ |
|------|------|------|-------|
| DSK_NAME | 100 | 30 | -70% |
| DSK_FARM | 100 | 30 | -70% |
| DSK_ADRS | 100 | 40 | -60% |
| DSK_DISC | 100 | 30 | -70% |
| DSK_INC | 19 | 12 | -7 |
| DSK_SPOUSE | 19 | 12 | -7 |

---

### ูุงู Workers (DSKWOR00.DBF)
- **ุชุนุฏุงุฏ ููุฏูุง:** 29 (ูุจูุงู 31 ุจูุฏ)
- **ุทูู ุฑฺฉูุฑุฏ:** 469 bytes (ูุจูุงู 398 bytes)
- **ุชุนุฏุงุฏ ุฑฺฉูุฑุฏูุง:** ุชุนุฏุงุฏ ฺฉุงุฑฺฏุฑุงู

**ููุฏูุง ุญุฐู ุดุฏู:**
- โ DSW_KOSO
- โ DSW_BIME20

**ุชุบุฑุงุช ุทูู:**
| ููุฏ | ูุฏู | ุฌุฏุฏ | ุชุบุฑ |
|------|------|------|-------|
| DSW_FNAME | 20 | 60 | +200% ๐ |
| DSW_LNAME | 25 | 60 | +140% ๐ |
| DSW_DNAME | 20 | 60 | +200% ๐ |
| DSW_JOB | 10 | 6 | -4 |
| DSW_INC | 19 | 12 | -7 |

**ุชุบุฑ ููุน:**
- DSW_SPOUSE: Number (N19) โ Character (C10)

**ุชุบุฑ ุชุฑุชุจ:**
- DSW_JOB: ูููุนุช 29 โ 26
- PER_NATCOD: ูููุนุช 28 โ 27

---

## ๐งช ุชุณุชโูุง

### Round-Trip Test
```bash
# ูุงู ุงุตู โ CSV โ DBF โ ููุงุณู
python tools/dbf_to_csv.py original.dbf -o temp.csv
python tools/csv_to_dbf_complete.py header.csv temp.csv \
    --workshop-id "..." --year 4 --month 7 --output-dir test
# Compare bytes: original.dbf == test/dskwor00.dbf
```

**ูุชุฌู:** โ ูุทุงุจูุช 100% byte-by-byte

---

### Encoding Test
```bash
python src/utils/test_encoding.py
```

**ุชุณุช ูโฺฉูุฏ:**
- โ ุญุฑูู ูุงุฑุณ (ุงูู ุชุง )
- โ ุงุนุฏุงุฏ ูุงุฑุณ (ฐ-น)
- โ ูุถุงูุง ุฎุงู
- โ Context-sensitive forms
- โ Visual order reversal

**ูุชุฌู:** โ ููู ุชุณุชโูุง ูููู

---

## ๐ ููุฏูุง ูุงุฑุณ (Iran System)

ุงู ููุฏูุง ุงุฒ Iran System ุงุณุชูุงุฏู ูโฺฉููุฏ:

### ุฏุฑ Header:
- DSK_NAME (ูุงู ฺฉุงุฑฺฏุงู)
- DSK_FARM (ูุงู ฺฉุงุฑูุฑูุง)
- DSK_ADRS (ุขุฏุฑุณ)
- DSK_DISC (ุชูุถุญุงุช)

### ุฏุฑ Workers:
- DSW_FNAME (ูุงู)
- DSW_LNAME (ูุงู ุฎุงููุงุฏฺฏ)
- DSW_DNAME (ูุงู ูพุฏุฑ)
- DSW_IDPLC (ูุญู ุตุฏูุฑ)
- DSW_OCP (ุดุบู)
- DSW_SEX (ุฌูุณุช: ูุฑุฏ/ุฒู)
- DSW_NAT (ููุช: ุงุฑุงู)

### ููุฏูุง ุบุฑ ูุงุฑุณ:
- DSW_JOB: ฺฉุฏ ุนุฏุฏ ุดุบู (ูุซู "035242")
- PER_NATCOD: ฺฉุฏ ูู (ุนุฏุฏ)
- ุชูุงู ุชุงุฑุฎโูุง: YYYYMMDD
- ุชูุงู ูุจุงูุบ: ุนุฏุฏ

---

## ๐ ูุญูู ุงุณุชูุงุฏู (ฺฏุงู ุจู ฺฏุงู)

### ูุฑุญูู 1: ุขูุงุฏูโุณุงุฒ CSV

**header.csv:**
```csv
DSK_ID,DSK_NAME,DSK_FARM,DSK_ADRS,DSK_DISC
9018282956,ฺฉุงุฑฺฏุงู ููููู,ูุฏุฑ ฺฉุงุฑฺฏุงู,ุชูุฑุงู ุฎุงุจุงู ููุนุตุฑ,ูุณุช ุชุฑ ูุงู
```

**workers.csv:**
```csv
DSW_ID1,DSW_FNAME,DSW_LNAME,DSW_DNAME,DSW_IDNO,DSW_IDPLC,DSW_IDATE,DSW_BDATE,DSW_SEX,DSW_NAT,DSW_OCP,DSW_SDATE,DSW_EDATE,DSW_DD,DSW_ROOZ,DSW_MAH,DSW_MAZ,DSW_MASH,DSW_TOTL,DSW_BIME,DSW_PRATE,DSW_JOB,PER_NATCOD,DSW_INC,DSW_SPOUSE
12345678,ุนู,ูุญูุฏ,ุญุณู,1234,ุชูุฑุงู,14030101,13650515,ูุฑุฏ,ุงุฑุงู,ฺฉุงุฑฺฏุฑ,14040701,14040731,31,0,50000000,5000000,55000000,55000000,3850000,7,035242,1234567890,0,0
```

---

### ูุฑุญูู 2: ุชุจุฏู ุจู DBF

```bash
python tools/csv_to_dbf_complete.py header.csv workers.csv \
    --workshop-id "9018282956" \
    --year 4 \
    --month 7 \
    --list-no "202407001" \
    --output-dir output
```

**ุฎุฑูุฌ:**
```
output/
โโโ dskkar00.dbf  (1.2 KB)
โโโ dskwor00.dbf  (2.4 KB)
```

---

### ูุฑุญูู 3: ุจุฑุฑุณ ุฎุฑูุฌ

```bash
# ุชุจุฏู ุจู CSV ุจุฑุง ุจุฑุฑุณ
python tools/dbf_to_csv.py output/dskkar00.dbf -o verify_header.csv
python tools/dbf_to_csv.py output/dskwor00.dbf -o verify_workers.csv

# ฺฺฉ ฺฉุฑุฏู ูุชู ูุงุฑุณ
cat verify_workers.csv
```

---

### ูุฑุญูู 4: ุขูพููุฏ ุจู SSO

1. ูุงุฑุฏ ุณุงุช ุชุงูู ุงุฌุชูุงุน ุดูุฏ
2. ุจุฎุด "ุงุฑุณุงู ูุณุช ุจูู" ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ
3. ูุฑ ุฏู ูุงู ุฑุง ุขูพููุฏ ฺฉูุฏ:
   - `dskkar00.dbf`
   - `dskwor00.dbf`
4. ุงุฑุณุงู ฺฉูุฏ

**ูุชุฌู:** โ ูุงูโูุง ูพุฐุฑูุชู ูโุดููุฏ

---

## ๐ ุฑูุน ูุดฺฉูุงุช ุฑุงุฌ

### 1. ูุชู ูุงุฑุณ ุจู ุตูุฑุช ??? ููุงุด ูโุฏูุฏ
**ุนูุช:** ูุงู CSV ุจุง encoding ุงุดุชุจุงู ุจุงุฒ ุดุฏู

**ุฑุงู ุญู:**
```bash
# ุงุทููุงู ุงุฒ UTF-8
file header.csv
# ุจุงุฏ ูุดุงู ุฏูุฏ: UTF-8 Unicode text
```

---

### 2. SSO ุฎุทุง ูโุฏูุฏ: "Unable to parse column"
**ุนูุช:** ุณุงุฎุชุงุฑ ูุฏู ุงุณุชูุงุฏู ุดุฏู

**ุฑุงู ุญู:**
- ุงุฒ ุงุจุฒุงุฑูุง ุจูโุฑูุฒ ุดุฏู ุงุณุชูุงุฏู ฺฉูุฏ
- ูุงูโูุง ููููู ุฏุฑ `newsample/` ุฑุง ฺฺฉ ฺฉูุฏ

---

### 3. ูุงูโูุง ฺฉูุชุงู ูโุดููุฏ
**ุนูุช:** ุฏุฑ ุณุงุฎุชุงุฑ ุฌุฏุฏุ ููุฏูุง ูุงู 60 ฺฉุงุฑุงฺฉุชุฑ ูุณุชูุฏ

**ุฑุงู ุญู:**
- ูฺฏุฑุงู ูุจุงุดุฏ! ุณุงุฎุชุงุฑ ุฌุฏุฏ 60 ฺฉุงุฑุงฺฉุชุฑ ูพุดุชุจุงู ูโฺฉูุฏ
- ูุงูโูุง ุจููุฏ ูุงุฑุณ ูุดฺฉู ูุฏุงุฑูุฏ

---

### 4. ฺฉุฏ ุดุบู ุจู ุตูุฑุช ูุชู ูุงุฑุณ ุฐุฎุฑู ูโุดูุฏ
**ุนูุช:** DSW_JOB ุฏุฑ persian_fields ุงุถุงูู ุดุฏู

**ุฑุงู ุญู:**
- ฺฉุฏ ุดุบู ุจุงุฏ ุนุฏุฏ ุจุงุดุฏ (ูุซู "035242")
- ุงุจุฒุงุฑูุง ุฌุฏุฏ ุงู ูุดฺฉู ุฑุง ูุฏุงุฑูุฏ

---

## ๐ ูุถุนุช ูพุฑูฺู

### โ ฺฉุงูู ุดุฏู:
- [x] Iran System encoding/decoding
- [x] ุชุจุฏู CSV โ DBF (ุณุงุฎุชุงุฑ 2024)
- [x] ุชุจุฏู DBF โ CSV
- [x] ุฑุงุจุท ฺฏุฑุงูฺฉ (GUI)
- [x] ุชุณุช Round-Trip
- [x] ูุณุชูุฏุงุช ฺฉุงูู
- [x] ูููููโูุง ูุงูุน
- [x] ุชุงุฏ SSO (ูุงูโูุง ูพุฐุฑูุชู ุดุฏูุฏ)

### ๐ ุฏุฑ ุญุงู ุชูุณุนู:
- [ ] ฺฉูพุงุฑฺฺฏ ุจุง SAP
- [ ] API ุจุฑุง ุณุฑูุณโูุง ูุจ
- [ ] Batch processing ุจุฑุง ูุงูโูุง ฺูุฏฺฏุงูู

### ๐ก ุงุฏูโูุง ุขูุฏู:
- [ ] Excel โ DBF ูุณุชูู
- [ ] ุชุดุฎุต ุฎูุฏฺฉุงุฑ ุณุงุฎุชุงุฑ ูุฏู/ุฌุฏุฏ
- [ ] Validation ูพุด ุงุฒ ุขูพููุฏ
- [ ] ฺฏุฒุงุฑุดโูุง ุขูุงุฑ

---

## ๐ ูพุดุชุจุงู

### ูุณุชูุฏุงุช:
- `docs/INSTALLATION.md` - ุฑุงูููุง ูุตุจ
- `docs/USAGE.md` - ุฑุงูููุง ุงุณุชูุงุฏู
- `docs/NEW_STRUCTURE_2024.md` - ูุฑุฌุน ุณุงุฎุชุงุฑ
- `docs/MIGRATION_TO_NEW_STRUCTURE.md` - ุฑุงูููุง ููุงุฌุฑุช

### Issues:
ุจุฑุง ฺฏุฒุงุฑุด ูุดฺฉู ุง ูพุดููุงุฏุ issue ุงุฌุงุฏ ฺฉูุฏ.

---

## ๐ ูุงุณูุณ

MIT License - ุงุณุชูุงุฏู ุขุฒุงุฏ ุจุฑุง ููู

---

**ุขุฎุฑู ุจูโุฑูุฒุฑุณุงู:** 1403/09/02
**ูุณุฎู:** 2.0 (ุจุง ูพุดุชุจุงู ุณุงุฎุชุงุฑ SSO 2024)
**ูุถุนุช:** โ ุชุณุช ุดุฏู ู ุชุงุฏ ุดุฏู ุชูุณุท ุณุงุช ุชุงูู ุงุฌุชูุงุน
