# ุฑุงูููุง ุงุณุชูุงุฏู
# Usage Guide

## ููุฑุณุช / Table of Contents

1. [ุงุณุชุฎุฑุงุฌ ุฏุงุฏู ุงุฒ SAP](#sap-extraction)
2. [ุชุจุฏู ุจู DBF](#dbf-conversion)
3. [ุขูพููุฏ ุจู ุชุงูู ุงุฌุชูุงุน](#upload-to-sso)
4. [ุนููุงุช ูุงูุงูู](#monthly-operations)
5. [ุนุจโุงุจ](#troubleshooting)

---

## <a name="sap-extraction"></a>1. ุงุณุชุฎุฑุงุฌ ุฏุงุฏู ุงุฒ SAP

### ุฑูุด A: ุงุฌุฑุง ุฏุณุช ุฏุฑ SAP GUI

#### ูุฑุญูู 1: ูุฑูุฏ ุจู SAP

```
ุชุฑุงฺฉูุด: SE38
ุจุฑูุงูู: ZHCM_SSO_EXTRACT
```

#### ูุฑุญูู 2: ูุงุฑุฏ ฺฉุฑุฏู ูพุงุฑุงูุชุฑูุง

**ุตูุญู ุงูุชุฎุงุจ (Selection Screen):**

```
ูพุงุฑุงูุชุฑูุง ูพุฑุณูู:
  ุดูุงุฑู ูพุฑุณูู (Personnel Number): 00000001 ุชุง 99999999

ุฏูุฑู ุฒูุงู:
  ุชุงุฑุฎ ุดุฑูุน (Start Date): 01.01.1402
  ุชุงุฑุฎ ูพุงุงู (End Date): 30.01.1402

ุชูุธูุงุช ุฎุฑูุฌ:
  ููุน ุฎุฑูุฌ (Output Type): J (JSON)
  ูุณุฑ ูุงู (File Path): /tmp/sso_output.json
```

#### ูุฑุญูู 3: ุงุฌุฑุง ุจุฑูุงูู

1. ฺฉูุฏ F8 ุฑุง ูุดุงุฑ ุฏูุฏ (ุงุฌุฑุง)
2. ููุชุธุฑ ุจูุงูุฏ ุชุง ูพุฑุฏุงุฒุด ุชูุงู ุดูุฏ
3. ูุงู JSON ุฑุง ุฏุงูููุฏ ฺฉูุฏ

### ุฑูุด B: ุงุฌุฑุง Batch Job

ุจุฑุง ุงุฌุฑุง ุฎูุฏฺฉุงุฑ ูุงูุงูู:

```
ุชุฑุงฺฉูุด: SM36
```

1. Job ุฌุฏุฏ ุงุฌุงุฏ ฺฉูุฏ
2. ูุงู: `MONTHLY_SSO_EXTRACT`
3. Step ุงุถุงูู ฺฉูุฏ:
   - ุจุฑูุงูู: `ZHCM_SSO_EXTRACT`
   - Variant: `MONTHLY`
4. ุฒูุงูโุจูุฏ:
   - ุฏูุฑู: ูุงูุงูู
   - ุฑูุฒ: ุขุฎุฑ ูุงู
   - ุณุงุนุช: 23:00

### ุฑูุด C: ุงุณุชูุงุฏู ุงุฒ RFC (ูพุดุฑูุชู)

ุจุฑุง ุงุชุตุงู ูุณุชูู Python ุจู SAP:

```python
from pyrfc import Connection

# ุงุชุตุงู ุจู SAP
conn = Connection(
    user='USERNAME',
    passwd='PASSWORD',
    ashost='sap-server.com',
    sysnr='00',
    client='100'
)

# ูุฑุงุฎูุงู Function Module
result = conn.call('Z_SSO_EXTRACT_RFC',
    IV_YEAR='1402',
    IV_MONTH='01'
)

conn.close()
```

---

## <a name="dbf-conversion"></a>2. ุชุจุฏู ุจู DBF

### ุงุณุชูุงุฏู ุงุฒ Script Python

#### ุฏุณุชูุฑ ูพุงู:

```bash
python src/utils/generate_dbf.py \
  --input /path/to/sap_output.json \
  --output /path/to/MADRAK_140201.DBF
```

#### ุจุง ุชูุธูุงุช ุณูุงุฑุด:

```bash
python src/utils/generate_dbf.py \
  --input data/payroll_1402_01.json \
  --output output/MADRAK_140201.DBF \
  --config config/field_mappings.json
```

### ุฎุฑูุฌ ููููู:

```
Loading data from data/payroll_1402_01.json...
Found 150 records
Validating records...
Validated 148 records
Creating DBF file: output/MADRAK_140201.DBF...
  Processed 100 records...
  Processed 148 records...
โ Successfully created DBF file with 148 records

โ Warnings (2):
  - Record 1234567890: Total mismatch (calculated: 65000000, provided: 65000001)
  - Record 0987654321: Working days is 31, check if correct

โ DBF file created successfully: output/MADRAK_140201.DBF
```

### ุจุฑุฑุณ ูุงู DBF

```bash
# ููุงุด ุงุทูุงุนุงุช ูุงู
python -c "from dbfpy3 import dbf; db = dbf.Dbf('output/MADRAK_140201.DBF'); print(f'Records: {len(db)}'); print(f'Fields: {[f.name for f in db.header.fields]}')"
```

---

## <a name="upload-to-sso"></a>3. ุขูพููุฏ ุจู ุชุงูู ุงุฌุชูุงุน

### ูุฑุญูู 1: ูุฑูุฏ ุจู ุณุงุช

1. ุขุฏุฑุณ: https://www.tamin.ir
2. ุจุฎุด **ฺฉุงุฑูุฑูุงุงู**
3. ูุงุฑุฏ ุดูุฏ ุจุง:
   - ฺฉุฏ ฺฉุงุฑฺฏุงู
   - ูุงู ฺฉุงุฑุจุฑ
   - ุฑูุฒ ุนุจูุฑ

### ูุฑุญูู 2: ุงูุชุฎุงุจ ุณุฑูุณ

```
ููู ุงุตู > ุฎุฏูุงุช ฺฉุงุฑูุฑูุงุงู > ูุณุช ูุงูุงูู ุจูู
```

### ูุฑุญูู 3: ุงูุชุฎุงุจ ุฏูุฑู

```
ุณุงู: 1402
ูุงู: ูุฑูุฑุฏู (1)
```

### ูุฑุญูู 4: ุขูพููุฏ ูุงู

1. ฺฉูฺฉ ุฑู **ุงูุชุฎุงุจ ูุงู**
2. ูุงู `MADRAK_140201.DBF` ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ
3. ฺฉูฺฉ ุฑู **ุจุงุฑฺฏุฐุงุฑ**

### ูุฑุญูู 5: ุจุฑุฑุณ ุฎุทุงูุง

ุณุณุชู ุฎุทุงูุง ุฑุง ููุงุด ูโุฏูุฏ:

**ุฎุทุงูุง ุฑุงุฌ:**

```
โ ฺฉุฏ ูู ูุงูุนุชุจุฑ ุงุณุช
   ุฑุงูโุญู: ุจุฑุฑุณ ุงูฺฏูุฑุชู checksum

โ ุดูุงุฑู ุจูู ุงูุช ูุดุฏ
   ุฑุงูโุญู: ุจุฑุฑุณ ุฏุฑ ุณุณุชู ุชุงูู ุงุฌุชูุงุน

โ ุฌูุน ูุฒุงุง ุตุญุญ ูุณุช
   ุฑุงูโุญู: HOGHOGH + EZAFE_KAR + MAZAYA = JAM_MAZAYA

โ ุชุงุฑุฎ ูุงูุนุชุจุฑ
   ุฑุงูโุญู: ูุฑูุช YYYYMMDD ุดูุณ
```

### ูุฑุญูู 6: ุงุฑุณุงู ููุง

ุงฺฏุฑ ุฎุทุง ูุจูุฏ:

1. ฺฉูฺฉ ุฑู **ุชุงุฏ ู ุงุฑุณุงู**
2. ุฑุณุฏ ุฏุฑุงูุช ฺฉูุฏ
3. ุฑุณุฏ ุฑุง ฺุงูพ ุง ุฐุฎุฑู ฺฉูุฏ

---

## <a name="monthly-operations"></a>4. ุนููุงุช ูุงูุงูู

### ฺฺฉโูุณุช ูุงูุงูู

#### ููุชู ุงูู ูุงู:

- [ ] ุงุฌุฑุง payroll ุฏุฑ SAP
- [ ] ุจุฑุฑุณ ูุชุงุฌ payroll
- [ ] ุฑูุน ุฎุทุงูุง ุงุญุชูุงู

#### ููุชู ุฏูู ูุงู:

- [ ] ุงุฌุฑุง ุจุฑูุงูู ุงุณุชุฎุฑุงุฌ `ZHCM_SSO_EXTRACT`
- [ ] ุฏุงูููุฏ ูุงู JSON ุฎุฑูุฌ
- [ ] ุจุฑุฑุณ ุชุนุฏุงุฏ ุฑฺฉูุฑุฏูุง

#### ููุชู ุณูู ูุงู:

- [ ] ุชุจุฏู JSON ุจู DBF
- [ ] ุงุนุชุจุงุฑุณูุฌ ูุงู DBF
- [ ] ุชุณุช ูุงู ุจุง ุฏุงุฏูโูุง ููููู

#### ููุชู ฺูุงุฑู ูุงู:

- [ ] ุขูพููุฏ ุจู ุณุงุช ุชุงูู ุงุฌุชูุงุน
- [ ] ุฑูุน ุฎุทุงูุง ุงุญุชูุงู
- [ ] ุงุฑุณุงู ููุง
- [ ] ุฏุฑุงูุช ู ุฐุฎุฑู ุฑุณุฏ

### Script ุฎูุฏฺฉุงุฑ ูุงูุงูู

ุงุฌุงุฏ ูุงู `monthly_process.sh`:

```bash
#!/bin/bash

# ุชูุธูุงุช
YEAR=$1
MONTH=$2
SAP_OUTPUT="/data/sap/sso_${YEAR}_${MONTH}.json"
DBF_OUTPUT="/data/dbf/MADRAK_${YEAR}${MONTH}.DBF"
BACKUP_DIR="/backup/sso/${YEAR}/${MONTH}"

# ุงุฌุงุฏ ุฏุงุฑฺฉุชุฑ backup
mkdir -p "$BACKUP_DIR"

# ุฏุงูููุฏ ุงุฒ SAP (manual step - needs user interaction)
echo "ูุทูุงู ูุงู JSON ุฑุง ุงุฒ SAP ุฏุงูููุฏ ฺฉูุฏ ู ุฏุฑ ูุณุฑ ุฒุฑ ูุฑุงุฑ ุฏูุฏ:"
echo "$SAP_OUTPUT"
read -p "ุขุง ูุงู ุขูุงุฏู ุงุณุชุ (y/n) " -n 1 -r
echo

if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    exit 1
fi

# ุชุจุฏู ุจู DBF
python src/utils/generate_dbf.py \
    --input "$SAP_OUTPUT" \
    --output "$DBF_OUTPUT"

# Backup
cp "$DBF_OUTPUT" "$BACKUP_DIR/"
cp "$SAP_OUTPUT" "$BACKUP_DIR/"

echo "โ ูุงู DBF ุขูุงุฏู ุงุณุช: $DBF_OUTPUT"
echo "โ Backup ุฐุฎุฑู ุดุฏ: $BACKUP_DIR"
```

ุงุณุชูุงุฏู:

```bash
chmod +x monthly_process.sh
./monthly_process.sh 1402 01
```

---

## <a name="troubleshooting"></a>5. ุนุจโุงุจ

### ูุดฺฉู: ูุงู JSON ุฎุงู ุงุณุช

**ุนูู ุงุญุชูุงู:**
- ูฺ ุฏุงุฏูโุง ุฏุฑ ุจุงุฒู ุงูุชุฎุงุจ ุดุฏู ูุณุช
- ุฎุทุง ุฏุฑ ุจุฑูุงูู ABAP
- ูุดฺฉู ุฏุฑ ุฏุณุชุฑุณโูุง

**ุฑุงูโุญู:**
```abap
" ุจุฑุฑุณ ุฏุฑ SAP:
SE38 > ZHCM_SSO_EXTRACT > F8
" ุจุฑุฑุณ ุฏุฑ Debugger:
/h
" ุณูพุณ F8
```

### ูุดฺฉู: ุฎุทุง ฺฉุฏฺฏุฐุงุฑ ูุงุฑุณ

**ุนูุงุฆู:**
- ูุงูโูุง ุจู ุตูุฑุช ุนูุงูุช ุณูุงู ููุงุด ุฏุงุฏู ูโุดููุฏ
- ฺฉุงุฑุงฺฉุชุฑูุง ูุงููููู

**ุฑุงูโุญู:**
```python
# ุจุฑุฑุณ encoding ูุงู JSON
with open('data.json', 'r', encoding='utf-8') as f:
    data = json.load(f)

# DBF ุจุงุฏ ุจุง Windows-1256 ุจุงุดุฏ
# ุงู ฺฉุงุฑ ุฏุฑ generate_dbf.py ุฎูุฏฺฉุงุฑ ุงูุฌุงู ูโุดูุฏ
```

### ูุดฺฉู: ุฎุทุง ุงุนุชุจุงุฑุณูุฌ ฺฉุฏ ูู

**ุฑุงูโุญู:**

```python
# ุชุณุช ฺฉุฏ ูู:
from src.utils.generate_dbf import SSODBFGenerator

gen = SSODBFGenerator()
print(gen.validate_national_id('0123456789'))  # ุจุงุฏ True ุจุงุดุฏ
```

### ูุดฺฉู: ุณุงุช ุชุงูู ุงุฌุชูุงุน ูุงู ุฑุง ูุจูู ููโฺฉูุฏ

**ฺฺฉโูุณุช:**

1. ูุฑูุช ูุงู DBF (dBase III/IV)
2. ูุงู ูุงู: `MADRAK_YYYYMM.DBF`
3. ฺฉุฏฺฏุฐุงุฑ: Windows-1256
4. ุชูุงู ููุฏูุง ุงูุฒุงู ูพุฑ ุดุฏูโุงูุฏ
5. ููุงุฏุฑ ุฏุฑ ูุญุฏูุฏู ูุฌุงุฒ ูุณุชูุฏ

**ุชุณุช ุฏุณุช:**

```bash
# ุจุงุฒ ฺฉุฑุฏู ุจุง LibreOffice
libreoffice --calc MADRAK_140201.DBF

# ุจุฑุฑุณ ุณุงุฎุชุงุฑ
file MADRAK_140201.DBF
```

---

## ูฺฉุงุช ููู

### ๐ ุงููุช

- **ูุฑฺฏุฒ** ูุงู `sap-config.json` ุฑุง commit ูฺฉูุฏ
- ุฑูุฒูุง ุนุจูุฑ ุฑุง ุฑูุฒูฺฏุงุฑ ฺฉูุฏ
- ูุงูโูุง DBF ุญุงู ุงุทูุงุนุงุช ุดุฎุต ูุณุชูุฏ

### ๐ ฺฏุฒุงุฑุดโฺฏุฑ

ููููู ฺฏุฒุงุฑุด ูุงูุงูู:

```
ฺฏุฒุงุฑุด ูุณุช ุจูู - ูุฑูุฑุฏู 1402
================================

ุชุนุฏุงุฏ ฺฉู ูพุฑุณูู: 150
ูพุฑุณูู ูุนุงู: 148
ูพุฑุณูู ุบุฑูุนุงู: 2

ุฌูุน ุญููู ูพุงู: 7,200,000,000 ุฑุงู
ุฌูุน ุงุถุงููโฺฉุงุฑ: 450,000,000 ุฑุงู
ุฌูุน ูุฒุงุง: 1,350,000,000 ุฑุงู
ุฌูุน ฺฉู: 9,000,000,000 ุฑุงู

ูุถุนุช ุงุฑุณุงู: โ ูููู
ุชุงุฑุฎ ุงุฑุณุงู: 1402/02/05
ุดูุงุฑู ุฑุณุฏ: 140202051234567
```

### ๐ Backup

ููุดู ูุจู ุงุฒ ุขูพููุฏ:

```bash
# Backup ุฎูุฏฺฉุงุฑ
cp output/MADRAK_140201.DBF \
   backup/MADRAK_140201_$(date +%Y%m%d_%H%M%S).DBF
```

---

## ูุฑุงุฌุน ุณุฑุน

### ุฏุณุชูุฑุงุช ููู

```bash
# ุชููุฏ DBF
python src/utils/generate_dbf.py -i input.json -o output.dbf

# ุงุฌุฑุง ุชุณุชโูุง
python tests/test_dbf_generation.py

# ุชุจุฏู ุชุงุฑุฎ
python src/utils/jalali_converter.py
```

### ุชุฑุงฺฉูุดโูุง SAP

```
SE38 - ABAP Editor
SM36 - Job Scheduling
PA30 - Maintain HR Master Data
PC00_M40_CALC - Payroll Driver
PA20 - Display HR Master Data
```

### ููฺฉโูุง ููุฏ

- ุณุงุช ุชุงูู ุงุฌุชูุงุน: https://www.tamin.ir
- ุฑุงูููุง ฺฉุงุฑูุฑูุงุงู: https://www.tamin.ir/employers
- ูพุดุชุจุงู: 1536

---

**ูุณุฎู**: 1.0
**ุชุงุฑุฎ**: 1403/11/01
